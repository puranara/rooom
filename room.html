<!DOCTYPE html>  
<html lang="zh-CN"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<title>THE ROOM - MULTIVERSE LOFI</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<style>
    /* =========================================
       1. å…¨å±€ä¸èƒŒæ™¯
    ========================================= */
    body {
        margin: 0; height: 100vh;
        display: flex; justify-content: center; align-items: center;
        overflow: hidden;
        font-family: 'VT323', monospace;
        background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
    }

    /* å™ªç‚¹è¦†ç›– */
    .noise-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 9999; opacity: 0.12;
        background: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)" opacity="1"/%3E%3C/svg%3E');
    }
    
    /* æš–è‰²å¤å¤æ»¤é•œ */
    body::after {
        content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle, rgba(255, 220, 180, 0.05) 0%, rgba(80, 40, 0, 0.3) 100%);
        pointer-events: none; z-index: 9998; mix-blend-mode: overlay;
    }

    /* =========================================
       2. CRT æ˜¾ç¤ºå™¨å®¹å™¨
    ========================================= */
    .crt-monitor {
        position: relative; width: 1100px; max-width: 95vw; aspect-ratio: 209 / 128; 
        border: 12px solid #5d4037; border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 80px rgba(0, 0, 0, 0.7); 
        background: #1a1005; margin: auto; overflow: hidden;
        opacity: 0;
        transition: opacity 1s ease;
    }

    /* æ‰«æçº¿æ•ˆæœ */
    .scanlines {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(255, 200, 100, 0.08) 50%, rgba(255, 200, 100, 0.08));
        background-size: 100% 4px; pointer-events: none; z-index: 999; opacity: 0.6; 
    }

    /* REC å½•åˆ¶æŒ‡ç¤ºç¯ */
    @keyframes blink-anim { 0%, 100% { opacity: 1; text-shadow: 0 0 5px #ff0000; } 50% { opacity: 0.3; text-shadow: none; } }
    .rec-indicator {
        position: absolute; top: 30px; right: 30px; color: #ff0000; z-index: 100; 
        font-family: 'VT323', monospace; font-weight: bold; font-size: 24px; letter-spacing: 2px;
        animation: blink-anim 1.5s infinite ease-in-out;
    }

    /* =========================================
       3. æˆ¿é—´ç‰©å“å¸ƒå±€
    ========================================= */
    #game-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; image-rendering: pixelated; }
    #game-content img { position: absolute; user-select: none; -webkit-user-drag: none; transition: opacity 0.3s ease, filter 0.2s, width 0.3s ease; }
    
    #sky-layer { width: 100%; height: 100%; z-index: 0; top: 0; left: 0; }
    #room-layer { width: 100%; height: 100%; z-index: 1; top: 0; left: 0; }
    
    /* ç‰©å“å®šä½ */
    #obj-tree { width: 13%; bottom: 7%; left: 5%; z-index: 20; }
    #obj-guitar { width: 6%; bottom: 12%; left: 30%; z-index: 50; }
    #obj-bass { width: 6%; bottom: 12%; left: 33%; z-index: 51; }
    #obj-keyboard { width: 14%; bottom: 86%; left: 84%; z-index: 52; }
    #obj-player { width: 8%; bottom: 5%; left: 47%; z-index: 53; }
    #obj-girl { width: 12%; bottom: 10%; left: 55%; z-index: 60; }
    #obj-computer { width: 8%; bottom: 3%; left: 2%; z-index: 55; }
    #obj-chords { width: 10%; bottom: 55%; left: 87%; z-index: 40; }
    #obj-book { width: 9%; bottom: 65%; left: 87%; z-index: 41; }
    #obj-fishtank { width: 11%; bottom: 5%; left: 78%; z-index: 13; }
    #obj-light { width: 4%; top: -1%; left: 40%; z-index: 70; }
    #obj-poster { width: 6%; bottom: 71%; left: 7%; z-index: 15; }
    #obj-cat { width: 7%; bottom: 13%; left: 16%; z-index: 54; }

    /* ç¯çš„æ‹‰åŠ¨åŠ¨ç”» */
    @keyframes pull-down-spring {
        0% { transform: translateY(0); }
        40% { transform: translateY(15px); } 
        100% { transform: translateY(0); }
    }
    .pull-active {
        animation: pull-down-spring 0.4s ease-in-out forwards;
    }

    /* å®æ—¶æ—¶é’Ÿ */
    #obj-clock { position: absolute; width: 8%; bottom: 36%; left: 87%; z-index: 42; aspect-ratio: 1/1; }
    #obj-clock img { width: 100%; height: 100%; position: relative; }
    .clock-hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom center; background: #222; pointer-events: none; border-radius: 2px; box-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
    .hour-hand { width: 4px; height: 25%; margin-left: -2px; }
    .min-hand { width: 3px; height: 35%; margin-left: -1.5px; }
    .sec-hand { width: 1px; height: 40%; margin-left: -0.5px; background: #a33; }
    .clock-center { position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; background: #111; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }

    /* =========================================
       4. æ··éŸ³å¼¹çª— (Mixer) æ ·å¼
    ========================================= */
    #mixer-overlay {
        display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.4); z-index: 2000; align-items: center; justify-content: center;
    }
    .lofi-window {
        background-color: #cfc6b8; 
        width: 460px; 
        border: 4px solid #111; 
        box-shadow: 12px 12px 0px rgba(0,0,0,0.5); 
        font-family: 'VT323', monospace; color: #111; position: relative;
    }
    .lofi-header {
        background: #111; color: #cfc6b8; 
        padding: 10px 15px; font-size: 28px; letter-spacing: 2px;
        display: flex; justify-content: space-between; align-items: center; text-transform: uppercase; 
        border-bottom: 4px solid #111;
    }
    .lofi-close { cursor: pointer; padding: 0 5px; font-weight: bold; }
    
    .lofi-content { padding: 30px; }
    .control-row { margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; }
    .label { font-size: 28px; width: 90px; text-transform: uppercase; }
    
    .pixel-slider-container { flex-grow: 1; height: 30px; display: flex; align-items: center; margin-left: 20px; cursor: pointer; position: relative; }
    .slider-track { width: 100%; height: 6px; background: #555; border: 2px solid #000; position: relative; }
    .slider-handle { 
        width: 20px; height: 34px; 
        background: #111; position: absolute; top: 50%; transform: translate(-50%, -50%); 
        border: 2px solid #cfc6b8; pointer-events: none; transition: left 0.1s; 
    }
    
    .pixel-toggle { width: 60px; height: 30px; border: 3px solid #111; position: relative; cursor: pointer; background: #cfc6b8; }
    .pixel-toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: #111; transition: transform 0.1s; }
    .pixel-toggle.active { background: #111; }
    .pixel-toggle.active::after { background: #cfc6b8; transform: translateX(30px); }
    
    .status-text { font-size: 22px; text-align: right; margin-top: -15px; margin-bottom: 25px; color: #555; }

    /* äº¤äº’ç±» */
    @keyframes float-gentle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    .anim-hover { cursor: pointer; }
    .anim-hover:hover { filter: brightness(1.2) sepia(0.3); animation: float-gentle 1s infinite ease-in-out; }
    .draggable { cursor: grab; }
    .draggable:active { cursor: grabbing; transform: scale(0.98); animation: none; }

    /* =========================================
       5. æ–°å¢ï¼šåƒç´ ç®­å¤´æç¤º
    ========================================= */
    .pixel-arrow {
        position: absolute;
        width: 24px;
        height: 24px;
        background-color: #44ff88;
        z-index: 999;
        pointer-events: none;
        opacity: 0;
        transform: translateY(0);
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    /* ç»˜åˆ¶åƒç´ ç®­å¤´å½¢çŠ¶ */
    .pixel-arrow::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        border-left: 12px solid transparent;
        border-right: 12px solid transparent;
        border-bottom: 12px solid #44ff88;
    }
    
    .pixel-arrow::after {
        content: '';
        position: absolute;
        top: 12px;
        left: 8px;
        width: 8px;
        height: 12px;
        background-color: #44ff88;
    }
    
    .pixel-arrow.show {
        opacity: 0.9;
        animation: arrow-bounce 1.5s infinite ease-in-out;
    }
    
    @keyframes arrow-bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }
    
    /* =========================================
       6. ä¿®å¤ï¼šå¥³å­©å¯¹è¯æ¡† - ç²¾ç¡®å®šä½ç‰ˆ
    ========================================= */
    .girl-dialog, .cat-dialog {
        position: absolute;
        width: 200px;
        background-color: #cfc6b8;
        border: 3px solid #111;
        padding: 15px;
        font-family: 'VT323', monospace;
        font-size: 18px;
        color: #111;
        z-index: 9999;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s ease, left 0.3s ease, top 0.3s ease;
        box-shadow: 6px 6px 0px rgba(0,0,0,0.3);
        pointer-events: none;
        visibility: visible !important;
        box-sizing: border-box;
    }
    
    .girl-dialog.show, .cat-dialog.show {
        opacity: 1;
        transform: translateY(0);
        visibility: visible !important;
    }
    
    /* å¥³å­©å¯¹è¯æ¡†ç®­å¤´æŒ‡å‘ä¸‹æ–¹ï¼ˆæŒ‡å‘å¥³å­©ï¼‰ */
    .girl-dialog::before {
        content: '';
        position: absolute;
        top: 100%; /* ç®­å¤´åœ¨å¯¹è¯æ¡†åº•éƒ¨ */
        left: 50%;
        transform: translateX(-50%);
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 15px solid #111;
    }
    
    .girl-dialog::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 13px solid #cfc6b8;
    }
    
    /* çŒ«å¯¹è¯æ¡†ç®­å¤´æŒ‡å‘ä¸‹æ–¹ï¼ˆæŒ‡å‘çŒ«ï¼‰ */
    .cat-dialog::before {
        content: '';
        position: absolute;
        top: 100%; /* ç®­å¤´åœ¨å¯¹è¯æ¡†åº•éƒ¨ */
        left: 50%;
        transform: translateX(-50%);
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 15px solid #111;
    }
    
    .cat-dialog::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 13px solid #cfc6b8;
    }
    
    .dialog-text {
        line-height: 1.4;
        margin: 0;
        text-align: left;
    }
    
    .dialog-counter {
        position: absolute;
        bottom: 5px;
        right: 10px;
        font-size: 14px;
        color: #555;
        margin: 0;
    }

    /* =========================================
       7. æ–°å¢ï¼šç®€åŒ–å¼€å§‹æç¤º
    ========================================= */
    #play-prompt {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: rgba(255, 255, 255, 0.85);
        z-index: 10001;
        text-align: center;
        font-family: 'VT323', monospace;
        font-size: 32px;
        cursor: pointer;
        animation: text-pulse 2s infinite ease-in-out;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        pointer-events: auto;
    }
    
    @keyframes text-pulse {
        0%, 100% { 
            opacity: 0.7;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        50% { 
            opacity: 1;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 30px rgba(255, 255, 255, 0.4);
        }
    }
    
    #play-prompt span {
        display: block;
        margin-top: 5px;
        font-size: 20px;
        opacity: 0.8;
    }

    /* åŠ è½½ç•Œé¢ */
    #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #44ff88;
        font-family: 'VT323', monospace;
        transition: opacity 0.5s ease;
    }
    
    #loading-progress {
        width: 300px;
        height: 20px;
        border: 2px solid #44ff88;
        margin-top: 20px;
        background: #000;
        overflow: hidden;
    }
    
    #loading-bar {
        width: 0%;
        height: 100%;
        background: #44ff88;
        transition: width 0.3s ease;
    }
    
    #loading-text {
        margin-top: 10px;
        font-size: 24px;
    }

</style>
</head> 

<body>

<div class="noise-overlay"></div>

<!-- åŠ è½½ç•Œé¢ -->
<div id="loading-overlay">
    <div style="font-size: 36px; margin-bottom: 20px;">THE ROOM</div>
    <div id="loading-progress">
        <div id="loading-bar"></div>
    </div>
    <div id="loading-text">0%</div>
</div>

<!-- éŸ³é¢‘å¼•æ“ -->
<div id="audio-engine" style="display:none;">
    <audio id="audio-ambience" loop preload="auto"></audio>
    <audio id="stem-drums" loop preload="auto"></audio>
    <audio id="stem-bass" loop preload="auto"></audio>
    <audio id="stem-guitar" loop preload="auto"></audio>
    <audio id="stem-other" loop preload="auto"></audio>
</div>

<!-- å¼€å§‹æç¤º -->
<div id="play-prompt">
    CLICK TO ENTER
    <span>ç‚¹å‡»è¿›å…¥</span>
</div>

<!-- CRTæ˜¾ç¤ºå™¨ -->
<div class="crt-monitor" id="monitor">
    <div class="scanlines"></div>
    <div class="rec-indicator">â— REC</div>

    <div id="game-content">
        <img id="sky-layer" src="assets/rain_bk.png" alt="Sky">
        <img id="room-layer" src="assets/rain.png" alt="Room">

        <img id="obj-tree" class="draggable anim-hover" src="assets/rain_tree.png" alt="Tree">
        <img id="obj-girl" class="draggable anim-hover" src="assets/girl.png" alt="Girl">
        <img id="obj-book" class="draggable anim-hover" src="assets/book.png" alt="Diary">
        <img id="obj-computer" class="draggable anim-hover" src="assets/computer.png" alt="Computer">
        <img id="obj-fishtank" class="draggable anim-hover" src="assets/fish.png" alt="Fish Tank">
        <img id="obj-light" class="draggable anim-hover" src="assets/light.png" alt="Light">
        <img id="obj-poster" class="draggable anim-hover" src="assets/poster.jpg" alt="Poster">
        <img id="obj-cat" class="draggable anim-hover" src="assets/cat.gif" alt="Cat">

        <img id="obj-guitar" class="draggable anim-hover" src="assets/guitar.png" alt="Guitar">
        <img id="obj-bass" class="draggable anim-hover" src="assets/bass.png" alt="Bass">
        <img id="obj-keyboard" class="draggable anim-hover" src="assets/keyboard.png" alt="Keyboard">
        <img id="obj-chords" class="draggable anim-hover" src="assets/chords.png" alt="Chords">
        
        <img id="obj-player" class="draggable anim-hover" src="assets/record player.png" alt="Player">

        <div id="obj-clock" class="draggable">
            <img src="assets/clock.png" alt="Clock Face"> 
            <div class="clock-hand hour-hand" id="ch-hour"></div>
            <div class="clock-hand min-hand" id="ch-min"></div>
            <div class="clock-hand sec-hand" id="ch-sec"></div>
            <div class="clock-center"></div>
        </div>

        <!-- å¥³å­©å¯¹è¯æ¡† -->
        <div id="girl-dialog" class="girl-dialog">
            <div class="dialog-text">å˜¿ï¼Œä½ æ‰¾åˆ°æˆ‘äº†ï¼åœ¨è¿™ä¸ªæ•°å­—å®‡å®™é‡Œï¼Œæ¯ä¸ªç‰©å“éƒ½æœ‰è‡ªå·±çš„æ•…äº‹ã€‚ç‚¹å‡»æˆ–æ‹–åŠ¨å®ƒä»¬ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ...</div>
            
        </div>

        <!-- çŒ«å¯¹è¯æ¡† -->
        <div id="cat-dialog" class="cat-dialog">
            <div class="dialog-text">å–µ...</div>
            
        </div>

        <!-- æ··éŸ³å™¨çª—å£ -->
        <div id="mixer-overlay">
            <div class="lofi-window">
                <div class="lofi-header">
                    <span id="win-title">GUITAR.EXE</span>
                    <span class="lofi-close" onclick="closeMixer()">[X]</span>
                </div>
                <div class="lofi-content">
                    <div class="control-row">
                        <span class="label">STATUS</span>
                        <div class="pixel-toggle active" id="toggle-mute" onclick="toggleSwitch(this)"></div>
                    </div>
                    <div class="status-text" id="status-text">CONNECTED</div>
                    <div class="control-row">
                        <span class="label">VOL</span>
                        <div class="pixel-slider-container" id="slider-vol" onclick="moveSlider(event, this)">
                            <div class="slider-track"></div>
                            <div class="slider-handle" style="left: 80%;"></div>
                        </div>
                    </div>
                    <div class="control-row"><span class="label">REVERB</span><div class="pixel-slider-container" onclick="moveSlider(event, this)"><div class="slider-track"></div><div class="slider-handle" style="left: 40%;"></div></div></div>
                    <div class="control-row"><span class="label">PAN</span><div class="pixel-slider-container" onclick="moveSlider(event, this)"><div class="slider-track"></div><div class="slider-handle" style="left: 50%;"></div></div></div>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    // =======================
    // ğŸµ 1. éŸ³é¢‘å¼•æ“ - å®Œå…¨ç‹¬ç«‹çš„ä¸»é¢˜éŸ³é¢‘ç³»ç»Ÿ
    // =======================
    const audioElements = {
        ambience: document.getElementById('audio-ambience'),
        drums: document.getElementById('stem-drums'),
        bass: document.getElementById('stem-bass'),
        guitar: document.getElementById('stem-guitar'),
        other: document.getElementById('stem-other')
    };

    // åˆå§‹åŒ–éŸ³é¢‘è®¾ç½®
    Object.values(audioElements).forEach(audio => {
        audio.volume = 0.8;
        audio.preload = 'none'; // æ”¹ä¸ºnoneï¼Œé¿å…è‡ªåŠ¨é¢„åŠ è½½
        audio.loop = true;
    });
    audioElements.ambience.volume = 0.3;

    let isPlaying = false;
    let userHasInteracted = false;
    let currentTheme = 'rain'; // é»˜è®¤ä¸»é¢˜

    // ä¸»é¢˜é…ç½®
    const themes = [
        { name: 'rain', size: '12%' },
        { name: 'desert', size: '11%' },
        { name: 'jungle', size: '18%' },
        { name: 'sea', size: '17%' },
        { name: 'snow', size: '22%' }
    ];

    // =======================
    // ğŸµ 2. éŸ³é¢‘ç®¡ç† - ç¡®ä¿ä¸ä¸²å°
    // =======================
    
    // åœæ­¢æ‰€æœ‰éŸ³é¢‘
    function stopAllAudio() {
        isPlaying = false;
        Object.values(audioElements).forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
    }

    // æ’­æ”¾å½“å‰ä¸»é¢˜çš„éŸ³é¢‘
    function playThemeAudio(themeName) {
        if (!userHasInteracted) return;
        
        console.log(`ğŸµ æ’­æ”¾ ${themeName} ä¸»é¢˜éŸ³ä¹`);
        isPlaying = true;
        
        // è®¾ç½®éŸ³é¢‘æº
        audioElements.ambience.src = `assets/${themeName}_ambience.mp3`;
        audioElements.drums.src = `assets/${themeName}_drums.mp3`;
        audioElements.bass.src = `assets/${themeName}_bass.mp3`;
        audioElements.guitar.src = `assets/${themeName}_guitar.mp3`;
        audioElements.other.src = `assets/${themeName}_other.mp3`;
        
        // å»¶è¿Ÿæ’­æ”¾ç¡®ä¿åŠ è½½
        setTimeout(() => {
            Object.values(audioElements).forEach((audio, index) => {
                setTimeout(() => {
                    audio.play().catch(e => {
                        console.log(`${themeName} éŸ³é¢‘æ’­æ”¾å¤±è´¥:`, e.message);
                    });
                }, index * 100);
            });
        }, 300);
    }

    // å®Œå…¨åœæ­¢å¹¶æ¸…ç©ºéŸ³é¢‘æº
    function resetAudioSources() {
        Object.values(audioElements).forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
            audio.src = ''; // æ¸…ç©ºæºï¼Œé˜²æ­¢æ®‹ç•™
        });
    }

    // =======================
    // ğŸ¨ 3. ä¸»é¢˜åˆ‡æ¢ - å®Œå…¨ç‹¬ç«‹çš„åˆ‡æ¢ç³»ç»Ÿ
    // =======================
    
    async function switchTheme(themeName) {
        console.log(`ğŸ”„ åˆ‡æ¢åˆ°: ${themeName} ä¸»é¢˜`);
        
        // ä¿å­˜æ’­æ”¾çŠ¶æ€
        const wasPlaying = isPlaying;
        
        // å®Œå…¨åœæ­¢å¹¶æ¸…ç©ºå‰ä¸€ä¸ªä¸»é¢˜çš„éŸ³é¢‘
        resetAudioSources();
        
        // è®¾ç½®æ–°ä¸»é¢˜
        currentTheme = themeName;
        localStorage.setItem('currentTheme', themeName);
        
        const skyLayer = document.getElementById('sky-layer');
        const roomLayer = document.getElementById('room-layer');
        const treeObj = document.getElementById('obj-tree');
        
        // è§†è§‰æ·¡å‡º
        skyLayer.style.opacity = 0;
        roomLayer.style.opacity = 0;
        treeObj.style.opacity = 0;
        
        setTimeout(() => {
            // æ›´æ–°å›¾ç‰‡
            skyLayer.src = `assets/${themeName}_bk.png`;
            roomLayer.src = `assets/${themeName}.png`;
            treeObj.src = `assets/${themeName}_tree.png`;
            treeObj.style.width = themes.find(t => t.name === themeName)?.size || '12%';
            
            // è§†è§‰æ·¡å…¥
            skyLayer.style.opacity = 1;
            roomLayer.style.opacity = 1;
            treeObj.style.opacity = 1;
            
            // å¦‚æœä¹‹å‰æ­£åœ¨æ’­æ”¾ï¼Œæ’­æ”¾æ–°ä¸»é¢˜éŸ³ä¹
            if (wasPlaying) {
                setTimeout(() => {
                    playThemeAudio(themeName);
                }, 500);
            }
        }, 300);
    }

    // ç‚¹å‡»æ ‘åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
        const currentIndex = themes.findIndex(t => t.name === currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        const nextTheme = themes[nextIndex].name;
        
        switchTheme(nextTheme);
    }

    // =======================
    // âš¡ 4. åŠ è½½ç³»ç»Ÿ
    // =======================
    function fastLoad() {
        console.log('ğŸš€ å¿«é€ŸåŠ è½½é¡µé¢...');
        
        const progressBar = document.getElementById('loading-bar');
        const loadingText = document.getElementById('loading-text');
        
        // è®¾ç½®é»˜è®¤ä¸»é¢˜å›¾ç‰‡
        document.getElementById('sky-layer').src = 'assets/rain_bk.png';
        document.getElementById('room-layer').src = 'assets/rain.png';
        document.getElementById('obj-tree').src = 'assets/rain_tree.png';
        document.getElementById('obj-tree').style.width = '12%';
        document.getElementById('obj-cat').src = 'assets/cat.gif';
        
        // å¿«é€Ÿè¿›åº¦æ¡
        let progress = 0;
        const interval = setInterval(() => {
            progress += 25;
            if (progressBar) progressBar.style.width = progress + '%';
            if (loadingText) loadingText.textContent = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.opacity = '0';
                    document.getElementById('monitor').style.opacity = '1';
                    
                    setTimeout(() => {
                        document.getElementById('loading-overlay').style.display = 'none';
                        // æ˜¾ç¤ºå¼€å§‹æç¤º
                        showStartPrompt();
                    }, 300);
                }, 200);
            }
        }, 100);
    }

    // æ˜¾ç¤ºå¼€å§‹æç¤º
    function showStartPrompt() {
        const prompt = document.getElementById('play-prompt');
        if (prompt) {
            prompt.style.display = 'block';
            
            // ç‚¹å‡»æç¤ºå¼€å§‹äº¤äº’
            prompt.addEventListener('click', function startInteraction() {
                userHasInteracted = true;
                prompt.style.opacity = '0';
                setTimeout(() => {
                    prompt.style.display = 'none';
                }, 500);
                
                // æ’­æ”¾rainä¸»é¢˜éŸ³ä¹
                playThemeAudio('rain');
                prompt.removeEventListener('click', startInteraction);
                
                // åˆå§‹åŒ–æç¤ºç³»ç»Ÿ
                setTimeout(() => {
                    initHintSystem();
                }, 500);
            });
        }
    }

    // =======================
    // ğŸ–±ï¸ 5. äº¤äº’ç³»ç»Ÿ
    // =======================
    function setupInteraction() {
        // å®æ—¶æ—¶é’Ÿ
        function updateClock() {
            const now = new Date();
            const sec = now.getSeconds(); 
            const min = now.getMinutes(); 
            const hour = now.getHours();
            const secDeg = sec * 6; 
            const minDeg = min * 6 + sec * 0.1; 
            const hourDeg = (hour % 12) * 30 + min * 0.5;
            
            const sHand = document.getElementById('ch-sec');
            const mHand = document.getElementById('ch-min');
            const hHand = document.getElementById('ch-hour');
            
            if(sHand) sHand.style.transform = `rotate(${secDeg}deg)`;
            if(mHand) mHand.style.transform = `rotate(${minDeg}deg)`;
            if(hHand) hHand.style.transform = `rotate(${hourDeg}deg)`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // æ‹–æ‹½ç³»ç»Ÿ
        const draggables = document.querySelectorAll('.draggable');
        const container = document.getElementById('game-content');
        
        draggables.forEach(item => {
            let isDragging = false, startX, startLeft, hasMoved = false;

            item.addEventListener('mousedown', (e) => {
                isDragging = true; 
                hasMoved = false; 
                startX = e.clientX;
                startLeft = (item.offsetLeft / container.offsetWidth) * 100;
                item.style.cursor = 'grabbing'; 
                item.style.animation = 'none'; 
                e.preventDefault(); 
            });

            window.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                if (Math.abs(e.clientX - startX) > 5) {
                    hasMoved = true;
                    const deltaX = ((e.clientX - startX) / container.offsetWidth) * 100;
                    let newLeft = startLeft + deltaX;
                    if(newLeft < -20) newLeft = -20; 
                    if(newLeft > 95) newLeft = 95;
                    item.style.left = newLeft + '%';
                    
                    // å¦‚æœæ‹–æ‹½çš„æ˜¯å¥³å­©ï¼Œæ›´æ–°å¯¹è¯æ¡†ä½ç½®
                    if (item.id === 'obj-girl') {
                        updateGirlDialogPosition();
                    }
                    // å¦‚æœæ‹–æ‹½çš„æ˜¯çŒ«ï¼Œæ›´æ–°å¯¹è¯æ¡†ä½ç½®
                    if (item.id === 'obj-cat') {
                        updateCatDialogPosition();
                    }
                    // æ›´æ–°ç®­å¤´ä½ç½®
                    updateArrowPosition(item.id);
                }
            });

            window.addEventListener('mouseup', () => {
                if(isDragging) {
                    isDragging = false; 
                    item.style.cursor = 'grab'; 
                    item.style.animation = ''; 
                    if (!hasMoved) handleClick(item.id);
                }
            });
        });

        // è§¦æ‘¸æ”¯æŒ
        draggables.forEach(item => {
            item.addEventListener('touchstart', (e) => {
                isDragging = true;
                hasMoved = false;
                startX = e.touches[0].clientX; 
                startLeft = (item.offsetLeft / container.offsetWidth) * 100;
                item.style.animation = 'none';
                e.preventDefault();
            });
            
            window.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const clientX = e.touches[0].clientX;
                if (Math.abs(clientX - startX) > 5) {
                    hasMoved = true;
                    const deltaX = ((clientX - startX) / container.offsetWidth) * 100;
                    let newLeft = startLeft + deltaX;
                    if(newLeft < -20) newLeft = -20;
                    if(newLeft > 95) newLeft = 95;
                    item.style.left = newLeft + '%';
                    
                    // å¦‚æœæ‹–æ‹½çš„æ˜¯å¥³å­©ï¼Œæ›´æ–°å¯¹è¯æ¡†ä½ç½®
                    if (item.id === 'obj-girl') {
                        updateGirlDialogPosition();
                    }
                    // å¦‚æœæ‹–æ‹½çš„æ˜¯çŒ«ï¼Œæ›´æ–°å¯¹è¯æ¡†ä½ç½®
                    if (item.id === 'obj-cat') {
                        updateCatDialogPosition();
                    }
                    // æ›´æ–°ç®­å¤´ä½ç½®
                    updateArrowPosition(item.id);
                }
            }, { passive: false });
            
            window.addEventListener('touchend', () => {
                if(isDragging) {
                    isDragging = false;
                    item.style.animation = '';
                    if (!hasMoved) handleClick(item.id);
                }
            });
        });
    }

    // ç‚¹å‡»å¤„ç†
    function handleClick(id) {
        // éšè—è¢«ç‚¹å‡»ç‰©å“çš„ç®­å¤´
        hideArrowOnClick(id);
        
        switch(id) {
            case 'obj-guitar': return openMixer('GUITAR');
            case 'obj-bass': return openMixer('BASS');
            case 'obj-keyboard': return openMixer('KEYBOARD');
            case 'obj-chords': return openMixer('CHORDS');
            case 'obj-player': return window.location.href = 'player.html';
            case 'obj-book': return window.location.href = 'diary.html';
            case 'obj-computer': return window.location.href = 'desktop.html';
            case 'obj-fishtank': return window.location.href = 'fish.html'; // é±¼ç¼¸è·³è½¬
            case 'obj-poster': return window.location.href = 'poster.html';
            case 'obj-light': 
                document.getElementById('obj-light').classList.add('pull-active');
                setTimeout(() => window.location.href = 'index.html', 400);
                return;
            case 'obj-tree': return toggleTheme();
            case 'obj-cat': return showCatDialog(); // ç‚¹å‡»çŒ«æ˜¾ç¤ºå¯¹è¯æ¡†
            case 'sky-layer': return openMixer('AMBIENCE');
        }
    }

    // =======================
    // ğŸ›ï¸ 6. æ··éŸ³å°ç³»ç»Ÿ
    // =======================
    let currentTargetAudio = null;

    function openMixer(instrument) {
        document.getElementById('win-title').innerText = instrument + ".EXE";
        document.getElementById('mixer-overlay').style.display = 'flex';
        
        if (instrument === 'AMBIENCE') currentTargetAudio = audioElements.ambience;
        else if (instrument === 'GUITAR') currentTargetAudio = audioElements.guitar;
        else if (instrument === 'BASS') currentTargetAudio = audioElements.bass;
        else if (instrument === 'KEYBOARD' || instrument === 'CHORDS') currentTargetAudio = audioElements.other;
        else currentTargetAudio = null;
        
        if (currentTargetAudio) {
            const muteBtn = document.getElementById('toggle-mute');
            const statusText = document.getElementById('status-text');
            
            muteBtn.classList.toggle('active', !currentTargetAudio.muted);
            statusText.innerText = currentTargetAudio.muted ? "MUTED" : "CONNECTED";
            
            const volHandle = document.querySelector('#slider-vol .slider-handle');
            if(volHandle) volHandle.style.left = (currentTargetAudio.volume * 100) + '%';
        }
    }

    function closeMixer() {
        document.getElementById('mixer-overlay').style.display = 'none';
    }

    function moveSlider(e, container) {
        const rect = container.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        let percent = (clickX / rect.width) * 100;
        if(percent < 0) percent = 0; 
        if(percent > 100) percent = 100;
        
        const handle = container.querySelector('.slider-handle');
        handle.style.left = percent + '%';
        
        if (container.id === 'slider-vol' && currentTargetAudio) {
            currentTargetAudio.volume = percent / 100;
        }
    }

    function toggleSwitch(el) {
        el.classList.toggle('active');
        const isActive = el.classList.contains('active');
        document.getElementById('status-text').innerText = isActive ? "CONNECTED" : "MUTED";
        
        if (currentTargetAudio) {
            currentTargetAudio.muted = !isActive;
        }
    }

    // =======================
    // ğŸ¯ 7. åƒç´ ç®­å¤´å’Œå¯¹è¯æ¡†ç³»ç»Ÿ
    // =======================
    
    let hintSystem = {
        arrows: {}, // å­˜å‚¨ç®­å¤´å…ƒç´ 
        dialogShown: false, // æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡å¯¹è¯æ¡†
        dialogCount: 0, // å¯¹è¯æ¡†æ˜¾ç¤ºæ¬¡æ•°
        hints: [
            "å˜¿ï¼Œä½ æ‰¾åˆ°æˆ‘äº†ï¼åœ¨è¿™ä¸ªæ•°å­—å®‡å®™é‡Œï¼Œæ¯ä¸ªç‰©å“éƒ½æœ‰è‡ªå·±çš„æ•…äº‹ã€‚ç‚¹å‡»æˆ–æ‹–åŠ¨å®ƒä»¬ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ...",
            "è¯•è¯•ç‚¹å‡»é‚£æ£µå°æ ‘ï¼Œå®ƒå¯ä»¥å¸¦ä½ å»ä¸åŒçš„ä¸–ç•Œï¼æ¯ä¸ªä¸–ç•Œéƒ½æœ‰ç‹¬ç‰¹çš„éŸ³ä¹å’Œæ°›å›´..."
        ],
        catDialogShown: false // çŒ«å¯¹è¯æ¡†æ˜¯å¦å·²æ˜¾ç¤º
    };
    
    // åˆå§‹åŒ–ç®­å¤´å’Œå¯¹è¯æ¡†ç³»ç»Ÿ
    function initHintSystem() {
        // åœ¨éœ€è¦æç¤ºçš„ç‰©å“ä¸Šæ·»åŠ ç®­å¤´
        addArrowToItem('obj-tree', 'ç‚¹å‡»åˆ‡æ¢ä¸–ç•Œ');
        addArrowToItem('obj-guitar', 'æ‰“å¼€æ··éŸ³å™¨');
        addArrowToItem('obj-player', 'æ’­æ”¾åˆ—è¡¨');
        addArrowToItem('obj-book', 'æŸ¥çœ‹æ—¥è®°');
        addArrowToItem('obj-computer', 'ç”µè„‘ç³»ç»Ÿ');
        
        // ç›‘å¬å¥³å­©ç‚¹å‡»ï¼Œæ˜¾ç¤ºå¯¹è¯æ¡†
        const girlElement = document.getElementById('obj-girl');
        if (girlElement) {
            girlElement.addEventListener('click', showGirlDialog);
            girlElement.addEventListener('touchstart', showGirlDialog);
        }
        
        // ç›‘å¬çŒ«ç‚¹å‡»ï¼Œæ˜¾ç¤ºå¯¹è¯æ¡†
        const catElement = document.getElementById('obj-cat');
        if (catElement) {
            catElement.addEventListener('click', showCatDialog);
            catElement.addEventListener('touchstart', showCatDialog);
        }
        
        // åˆå§‹åŒ–ç®­å¤´ä¸ºéšè—çŠ¶æ€
        hideAllArrows();
        
        // é¡µé¢åŠ è½½åå»¶è¿Ÿæ˜¾ç¤ºç¬¬ä¸€æ¬¡æç¤º
        setTimeout(() => {
            showFirstHint();
        }, 2000);
    }
    
    // ä¸ºç‰©å“æ·»åŠ ç®­å¤´
    function addArrowToItem(itemId, hintText) {
        const item = document.getElementById(itemId);
        if (!item) return;
        
        // åˆ›å»ºç®­å¤´å…ƒç´ 
        const arrow = document.createElement('div');
        arrow.className = 'pixel-arrow';
        arrow.dataset.target = itemId;
        arrow.dataset.hint = hintText;
        
        // å®šä½ç®­å¤´ï¼ˆåœ¨ç‰©å“ä¸Šæ–¹ï¼‰
        const arrowId = `arrow-${itemId}`;
        arrow.id = arrowId;
        
        // æ·»åŠ åˆ°ç‰©å“å®¹å™¨
        const gameContent = document.getElementById('game-content');
        gameContent.appendChild(arrow);
        
        // å­˜å‚¨å¼•ç”¨
        hintSystem.arrows[itemId] = arrow;
        
        // åˆå§‹ä½ç½®è®¾ç½®
        updateArrowPosition(itemId);
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œæ›´æ–°ç®­å¤´ä½ç½®
        window.addEventListener('resize', () => updateArrowPosition(itemId));
    }
    
    // æ›´æ–°ç®­å¤´ä½ç½®
    function updateArrowPosition(itemId) {
        const item = document.getElementById(itemId);
        const arrow = hintSystem.arrows[itemId];
        if (!item || !arrow) return;
        
        const itemRect = item.getBoundingClientRect();
        const containerRect = document.getElementById('game-content').getBoundingClientRect();
        
        // è®¡ç®—ç®­å¤´ä½ç½®ï¼ˆåœ¨ç‰©å“é¡¶éƒ¨ä¸­é—´ï¼‰
        const arrowTop = itemRect.top - containerRect.top - 30;
        const arrowLeft = itemRect.left - containerRect.left + (itemRect.width / 2) - 12;
        
        arrow.style.top = `${arrowTop}px`;
        arrow.style.left = `${arrowLeft}px`;
    }
    
    // æ˜¾ç¤ºæ‰€æœ‰ç®­å¤´
    function showAllArrows() {
        Object.values(hintSystem.arrows).forEach(arrow => {
            arrow.classList.add('show');
        });
    }
    
    // éšè—æ‰€æœ‰ç®­å¤´
    function hideAllArrows() {
        Object.values(hintSystem.arrows).forEach(arrow => {
            arrow.classList.remove('show');
        });
    }
    
    // æ˜¾ç¤ºç¬¬ä¸€ä¸ªæç¤º
    function showFirstHint() {
        // æ˜¾ç¤ºå¥³å­©å¯¹è¯æ¡†ï¼ˆç¬¬ä¸€æ¬¡ï¼‰
        showGirlDialog();
        
        // 3ç§’åæ˜¾ç¤ºæ‰€æœ‰ç®­å¤´
        setTimeout(() => {
            showAllArrows();
        }, 3000);
        
        // 5ç§’åéšè—å¯¹è¯æ¡†
        setTimeout(() => {
            hideGirlDialog();
        }, 5000);
        
        // 10ç§’åå†æ¬¡æ˜¾ç¤ºå¯¹è¯æ¡†ï¼ˆç¬¬äºŒæ¬¡ï¼‰
        setTimeout(() => {
            if (hintSystem.dialogCount < 2) {
                showGirlDialog();
                
                // 5ç§’åéšè—ç¬¬äºŒæ¬¡å¯¹è¯æ¡†
                setTimeout(() => {
                    hideGirlDialog();
                    hintSystem.dialogCount = 2; // æ ‡è®°ä¸ºå·²æ˜¾ç¤ºä¸¤æ¬¡
                    
                    // å¥³å­©å¯¹è¯æ¡†æ˜¾ç¤ºå®Œåï¼Œæ˜¾ç¤ºçŒ«çš„å¯¹è¯æ¡†
                    setTimeout(() => {
                        showCatDialog();
                    }, 1000);
                }, 5000);
            }
        }, 10000);
    }
    
    // æ˜¾ç¤ºå¥³å­©å¯¹è¯æ¡†ï¼ˆä¿®å¤ç‰ˆï¼‰
    function showGirlDialog() {
        const dialog = document.getElementById('girl-dialog');
        if (!dialog || hintSystem.dialogCount >= 2) return;
        
        // è·å–å¥³å­©å…ƒç´ çš„ä½ç½®
        const girlElement = document.getElementById('obj-girl');
        if (!girlElement) return;
        
        // è·å–å¥³å­©å…ƒç´ åœ¨å®¹å™¨å†…çš„ä½ç½®
        const girlRect = girlElement.getBoundingClientRect();
        const containerRect = document.getElementById('game-content').getBoundingClientRect();
        
        // è®¡ç®—å¯¹è¯æ¡†ä½ç½®ï¼ˆåœ¨å¥³å­©ä¸Šæ–¹ä¸­å¤®ï¼‰
        const dialogWidth = 200;
        const dialogHeight = 120; // ä¼°ç®—é«˜åº¦
        
        // è®¡ç®—å¯¹è¯æ¡†åº”è¯¥å‡ºç°çš„ä½ç½®
        // æ°´å¹³ï¼šå¥³å­©ä¸­å¿ƒç‚¹ - å¯¹è¯æ¡†å®½åº¦çš„ä¸€åŠ
        const dialogLeft = girlRect.left - containerRect.left + (girlRect.width / 2) - (dialogWidth / 2);
        
        // å‚ç›´ï¼šå¥³å­©é¡¶éƒ¨ - å¯¹è¯æ¡†é«˜åº¦ - 10pxé—´è·
        const dialogTop = girlRect.top - containerRect.top - dialogHeight - 10;
        
        // è®¾ç½®å¯¹è¯æ¡†ä½ç½®
        dialog.style.left = `${dialogLeft}px`;
        dialog.style.top = `${dialogTop}px`;
        
        // è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿å¯¹è¯æ¡†ä¸è¶…å‡ºå®¹å™¨
        const maxLeft = containerRect.width - dialogWidth - 10;
        const maxTop = containerRect.height - dialogHeight - 10;
        
        if (dialogLeft < 10) dialog.style.left = '10px';
        if (dialogLeft > maxLeft) dialog.style.left = `${maxLeft}px`;
        if (dialogTop < 10) dialog.style.top = '10px';
        if (dialogTop > maxTop) dialog.style.top = `${maxTop}px`;
        
        // æ›´æ–°å¯¹è¯æ¡†å†…å®¹
        const dialogText = dialog.querySelector('.dialog-text');
        const dialogCounter = dialog.querySelector('.dialog-counter');
        
        if (dialogText) {
            dialogText.textContent = hintSystem.hints[hintSystem.dialogCount];
        }
        
        if (dialogCounter) {
            dialogCounter.textContent = `æç¤º ${hintSystem.dialogCount + 1}/2`;
        }
        
        // æ˜¾ç¤ºå¯¹è¯æ¡†
        dialog.classList.add('show');
        hintSystem.dialogShown = true;
        hintSystem.dialogCount++;
        
        console.log(`ğŸ’¬ å¥³å­©å¯¹è¯æ¡†æ˜¾ç¤º (${hintSystem.dialogCount}/2) ä½ç½®: left=${dialogLeft}, top=${dialogTop}`);
    }
    
    // æ›´æ–°å¥³å­©å¯¹è¯æ¡†ä½ç½®ï¼ˆå½“å¥³å­©è¢«æ‹–æ‹½æ—¶ï¼‰
    function updateGirlDialogPosition() {
        const dialog = document.getElementById('girl-dialog');
        if (!dialog || !dialog.classList.contains('show')) return;
        
        const girlElement = document.getElementById('obj-girl');
        if (!girlElement) return;
        
        // è·å–å¥³å­©å…ƒç´ åœ¨å®¹å™¨å†…çš„ä½ç½®
        const girlRect = girlElement.getBoundingClientRect();
        const containerRect = document.getElementById('game-content').getBoundingClientRect();
        
        // è®¡ç®—å¯¹è¯æ¡†ä½ç½®
        const dialogWidth = 200;
        const dialogHeight = 120;
        
        const dialogLeft = girlRect.left - containerRect.left + (girlRect.width / 2) - (dialogWidth / 2);
        const dialogTop = girlRect.top - containerRect.top - dialogHeight - 10;
        
        // è®¾ç½®å¯¹è¯æ¡†ä½ç½®
        dialog.style.left = `${dialogLeft}px`;
        dialog.style.top = `${dialogTop}px`;
        
        // è¾¹ç•Œæ£€æŸ¥
        const maxLeft = containerRect.width - dialogWidth - 10;
        const maxTop = containerRect.height - dialogHeight - 10;
        
        if (dialogLeft < 10) dialog.style.left = '10px';
        if (dialogLeft > maxLeft) dialog.style.left = `${maxLeft}px`;
        if (dialogTop < 10) dialog.style.top = '10px';
        if (dialogTop > maxTop) dialog.style.top = `${maxTop}px`;
    }
    
    // éšè—å¥³å­©å¯¹è¯æ¡†
    function hideGirlDialog() {
        const dialog = document.getElementById('girl-dialog');
        if (dialog) {
            dialog.classList.remove('show');
        }
    }
    
    // æ˜¾ç¤ºçŒ«å¯¹è¯æ¡†
    function showCatDialog() {
        const dialog = document.getElementById('cat-dialog');
        if (!dialog || hintSystem.catDialogShown) return;
        
        // è·å–çŒ«å…ƒç´ çš„ä½ç½®
        const catElement = document.getElementById('obj-cat');
        if (!catElement) return;
        
        // è·å–çŒ«å…ƒç´ åœ¨å®¹å™¨å†…çš„ä½ç½®
        const catRect = catElement.getBoundingClientRect();
        const containerRect = document.getElementById('game-content').getBoundingClientRect();
        
        // è®¡ç®—å¯¹è¯æ¡†ä½ç½®ï¼ˆåœ¨çŒ«ä¸Šæ–¹ä¸­å¤®ï¼‰
        const dialogWidth = 150; // çŒ«çš„å¯¹è¯æ¡†è¾ƒå°
        const dialogHeight = 80; // ä¼°ç®—é«˜åº¦
        
        // è®¡ç®—å¯¹è¯æ¡†åº”è¯¥å‡ºç°çš„ä½ç½®
        // æ°´å¹³ï¼šçŒ«ä¸­å¿ƒç‚¹ - å¯¹è¯æ¡†å®½åº¦çš„ä¸€åŠ
        const dialogLeft = catRect.left - containerRect.left + (catRect.width / 2) - (dialogWidth / 2);
        
        // å‚ç›´ï¼šçŒ«é¡¶éƒ¨ - å¯¹è¯æ¡†é«˜åº¦ - 10pxé—´è·
        const dialogTop = catRect.top - containerRect.top - dialogHeight - 10;
        
        // è®¾ç½®å¯¹è¯æ¡†ä½ç½®
        dialog.style.left = `${dialogLeft}px`;
        dialog.style.top = `${dialogTop}px`;
        
        // è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿å¯¹è¯æ¡†ä¸è¶…å‡ºå®¹å™¨
        const maxLeft = containerRect.width - dialogWidth - 10;
        const maxTop = containerRect.height - dialogHeight - 10;
        
        if (dialogLeft < 10) dialog.style.left = '10px';
        if (dialogLeft > maxLeft) dialog.style.left = `${maxLeft}px`;
        if (dialogTop < 10) dialog.style.top = '10px';
        if (dialogTop > maxTop) dialog.style.top = `${maxTop}px`;
        
        // æ˜¾ç¤ºå¯¹è¯æ¡†
        dialog.classList.add('show');
        hintSystem.catDialogShown = true;
        
        console.log(`ğŸ± çŒ«å¯¹è¯æ¡†æ˜¾ç¤º ä½ç½®: left=${dialogLeft}, top=${dialogTop}`);
        
        // 3ç§’åè‡ªåŠ¨éšè—çŒ«å¯¹è¯æ¡†
        setTimeout(() => {
            hideCatDialog();
        }, 3000);
    }
    
    // æ›´æ–°çŒ«å¯¹è¯æ¡†ä½ç½®ï¼ˆå½“çŒ«è¢«æ‹–æ‹½æ—¶ï¼‰
    function updateCatDialogPosition() {
        const dialog = document.getElementById('cat-dialog');
        if (!dialog || !dialog.classList.contains('show')) return;
        
        const catElement = document.getElementById('obj-cat');
        if (!catElement) return;
        
        // è·å–çŒ«å…ƒç´ åœ¨å®¹å™¨å†…çš„ä½ç½®
        const catRect = catElement.getBoundingClientRect();
        const containerRect = document.getElementById('game-content').getBoundingClientRect();
        
        // è®¡ç®—å¯¹è¯æ¡†ä½ç½®
        const dialogWidth = 150;
        const dialogHeight = 80;
        
        const dialogLeft = catRect.left - containerRect.left + (catRect.width / 2) - (dialogWidth / 2);
        const dialogTop = catRect.top - containerRect.top - dialogHeight - 10;
        
        // è®¾ç½®å¯¹è¯æ¡†ä½ç½®
        dialog.style.left = `${dialogLeft}px`;
        dialog.style.top = `${dialogTop}px`;
        
        // è¾¹ç•Œæ£€æŸ¥
        const maxLeft = containerRect.width - dialogWidth - 10;
        const maxTop = containerRect.height - dialogHeight - 10;
        
        if (dialogLeft < 10) dialog.style.left = '10px';
        if (dialogLeft > maxLeft) dialog.style.left = `${maxLeft}px`;
        if (dialogTop < 10) dialog.style.top = '10px';
        if (dialogTop > maxTop) dialog.style.top = `${maxTop}px`;
    }
    
    // éšè—çŒ«å¯¹è¯æ¡†
    function hideCatDialog() {
        const dialog = document.getElementById('cat-dialog');
        if (dialog) {
            dialog.classList.remove('show');
        }
    }
    
    // å½“ç‰©å“è¢«ç‚¹å‡»æ—¶ï¼Œéšè—å¯¹åº”çš„ç®­å¤´
    function hideArrowOnClick(itemId) {
        const arrow = hintSystem.arrows[itemId];
        if (arrow) {
            // å¯ä»¥æ·»åŠ æ·¡å‡ºæ•ˆæœ
            arrow.style.opacity = '0';
            setTimeout(() => {
                arrow.style.display = 'none';
            }, 500);
        }
    }

    // =======================
    // ğŸš€ 8. é¡µé¢åˆå§‹åŒ–
    // =======================
    document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸ® é¡µé¢åˆå§‹åŒ–å¼€å§‹...');
        
        // 1. å¿«é€ŸåŠ è½½é¡µé¢
        fastLoad();
        
        // 2. è®¾ç½®äº¤äº’ç³»ç»Ÿ
        setupInteraction();
        
        // 3. å…¨å±€ç‚¹å‡»ç›‘å¬ï¼ˆä½œä¸ºå¤‡é€‰å¼€å§‹æ–¹å¼ï¼‰
        document.addEventListener('click', function initAudio() {
            if (!userHasInteracted) {
                userHasInteracted = true;
                // ç§»é™¤å¼€å§‹æç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const prompt = document.getElementById('play-prompt');
                if (prompt) {
                    prompt.style.opacity = '0';
                    setTimeout(() => {
                        prompt.style.display = 'none';
                    }, 500);
                }
                // æ’­æ”¾rainä¸»é¢˜éŸ³ä¹
                playThemeAudio('rain');
                document.removeEventListener('click', initAudio);
                
                // åˆå§‹åŒ–æç¤ºç³»ç»Ÿ
                setTimeout(() => {
                    initHintSystem();
                }, 500);
            }
        });
        
        console.log('âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    });
</script>
</body>
</html>